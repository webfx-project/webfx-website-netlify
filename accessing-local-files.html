<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@WebFXProject"><meta name="twitter:creator" content="@WebFXProject"><meta name="twitter:title" content="Accessing local files with WebFX"><meta name="twitter:description" content="How to access local files with WebFX"><meta name="twitter:image" content="https://blog.webfx.dev/accessing-local-files.htmlFilesDemo.png"><title> Accessing local files with WebFX · The WebFX blog</title><meta name="description" content="Accessing local files with WebFX - Bruno Salmon"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="favicon.png"><link rel="stylesheet" href="css/hermes.css"><link rel="search" type="application/opensearchdescription+xml" href="https://blog.webfx.dev/atom.xml" title="The WebFX blog"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="atom.xml" title="The WebFX blog" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="index.html"><img src="WebFX.svg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="index.html" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/webfx-project/webfx" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="atom.xml" target="_self">FEED</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Accessing local files with WebFX</h1><div class="post-info">Oct 19, 2022</div><div class="post-content"><p> First of all, a big thank you to the whole JavaFX community for warmly welcoming us on Twitter. In just a couple of days after creating our account, you were 100+ to follow us! And <a target="_blank" rel="noopener" href="https://www.jfx-central.com/">JFX-Central</a> kindly listed us in their <em>Links of the Week</em> on September 30, including our previous blog post and demo. Thank you all for your interest in WebFX! ❤️</p>
<p>Thank you also for your questions. And it appeared that the most frequent question asked so far was about accessing local files. So we investigated this possibility, and we are glad to announce that now WebFX can access local files, and we made this brand-new <a target="_blank" rel="noopener" href="https://files.webfx.dev/">Files demo</a> to demonstrate this.</p>
<p>This demo lets you select local files with either the <em>Choose files</em> button or drag &amp; drop. The files are listed with their icon and other simple details, and a thumbnail is displayed for images. A grid view is also available with just the thumbnails. You can open your images in full size, and navigate using left &amp; right keys, left &amp; right mouse clicks, or left &amp; right swipes on touch screens. Same with your audio files, which are played together with the equaliser from our DemoFX library. Video files will be played very soon (only the audio is supported for now). Text files can be displayed in a TextArea.</p>
<h1 id="The-issue-with-the-JavaFX-FileChooser-API"><a href="#The-issue-with-the-JavaFX-FileChooser-API" class="headerlink" title="The issue with the JavaFX FileChooser API"></a>The issue with the JavaFX FileChooser API</h1><p>Our first investigation was rather bad news: it appeared that it was impossible to emulate the JavaFX FileChooser API in the browser, mainly for the 2 following reasons:</p>
<ul>
<li><p>In JavaFX, opening the file chooser is done programmatically through a call to FileChooser.showOpenDialog(), which in addition is a blocking call - something prohibited in JavaScript. In the browser however, it is done through a user interaction with the HTML input element <code>&lt;input type=&quot;file&quot;&gt;</code> which is rendered by default with this (ugly) button: <input type="file">   </p>
</li>
<li><p>The Web <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/File">File</a> object returned by the browser sandbox has very limited information about the actual local file. For example, it doesn’t let you know its location on the local device, and its URL is a kind of random UUID valid only for the time of the session. With such a limited object, it’s impossible to emulate java.io.File, the object returned by the JavaFX FileChooser.</p>
</li>
</ul>
<h1 id="The-alternative-WebFX-cross-platform-API"><a href="#The-alternative-WebFX-cross-platform-API" class="headerlink" title="The alternative WebFX cross-platform API"></a>The alternative WebFX cross-platform API</h1><p>While it looks impossible to emulate the JavaFX FileChooser and the Java File API in the browser, the opposite is possible: it’s quite simple to emulate the Web FilePicker and Web File API in Java&#x2F;JavaFX. This is therefore the WebFX approach.</p>
<p>In our <a target="_blank" rel="noopener" href="https://github.com/webfx-project/webfx-platform">WebFX Platform</a>, you will see these 3 new modules:</p>
<ul>
<li><code>webfx-platform-file</code> : our File API (<code>dev.webfx.platform.file.*</code>)</li>
<li><code>webfx-platform-file-java</code> : Java implementation (using Java File)</li>
<li><code>webfx-platform-file-gwt</code> : GWT implementation (using Web File)</li>
</ul>
<p>And in our <a target="_blank" rel="noopener" href="https://github.com/webfx-project/webfx-extras">WebFX Extras</a> library, these 3 new modules:</p>
<ul>
<li><code>webfx-extras-filepicker</code>: our FilePicker API (<code>dev.webfx.extras.filepicker.*</code>)</li>
<li><code>webfx-extras-filepicker-openjfx</code> : OpenJFX implementation (using FileChooser)</li>
<li><code>webfx-extras-filepicker-gwt</code> : GWT implementation (using Web FilePicker)</li>
</ul>
<h1 id="Including-this-new-API-in-your-project"><a href="#Including-this-new-API-in-your-project" class="headerlink" title="Including this new API in your project"></a>Including this new API in your project</h1><p>Assuming you already followed our <a target="_blank" rel="noopener" href="https://docs.webfx.dev/#_getting_started">getting started guide</a>, just add this in your <code>webfx.xml</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">required-libraries</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">webfx-library</span> <span class="attr">artifact</span>=<span class="string">&quot;dev.webfx:webfx-extras:0.1.0-SNAPSHOT&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">required-libraries</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>This will just make our WebFX CLI aware of the WebFX Extras library (no need to do it for the WebFX platform library, as it’s a transitive dependency). Then, each time it will see a usage of the <code>dev.webfx.extras.filepicker</code> package in your code, it will automatically add the <code>webfx-extras-filepicker</code> module to your build chain (Maven, GWT, etc…). Same with the <code>dev.webfx.platform.file</code> package and its associated <code>webfx-platform-file</code> module.</p>
<p>For example, if you now add this import to one of your Java file:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dev.webfx.extras.filepicker.*;</span><br></pre></td></tr></table></figure>
<p>and then invoke the WebFX CLI in your terminal with:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webfx update</span><br></pre></td></tr></table></figure>
<p>your build chain will be updated, and you are ready to use this new API in your Java IDE! </p>
<h1 id="Ok-great-now-show-me-the-code"><a href="#Ok-great-now-show-me-the-code" class="headerlink" title="Ok great, now show me the code!"></a>Ok great, now show me the code!</h1><p>You can find the complete source code of the demo on <a target="_blank" rel="noopener" href="https://github.com/webfx-demos/webfx-demo-files/blob/main/webfx-demo-files-application/src/main/java/dev/webfx/demo/files/FilesApplication.java">GitHub</a>, but we will concentrate here on the essential parts. To start with, here is how to use the WebFX <strong>FilePicker</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Creating an instance of FilePicker</span></span><br><span class="line"><span class="type">FilePicker</span> <span class="variable">filePicker</span> <span class="operator">=</span> FilePicker.create(); <span class="comment">// OpenJFX or GWT instance</span></span><br><span class="line"><span class="comment">// Customizing the FilePicker button appearance</span></span><br><span class="line">filePicker.setGraphic(myBeautifulJavaFXNode); </span><br><span class="line"><span class="comment">// Allowing multiple file selection</span></span><br><span class="line">filePicker.setMultiple(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">// Inserting the FilePicker button in the UI</span></span><br><span class="line">myBorderPane.setTop(filePicker.getView()); <span class="comment">// Just as an example</span></span><br><span class="line"><span class="comment">// Reacting to the user files selection</span></span><br><span class="line">filePicker.getSelectedFiles().addListener((InvalidationListener) obs -&gt; &#123;</span><br><span class="line">    <span class="comment">// Getting the selected files</span></span><br><span class="line">    List&lt;File&gt; fileList = filePicker.getSelectedFiles();</span><br><span class="line">    ... <span class="comment">// Your code treating these files</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


<p>As you can see, there is no programmatic call to open the FilePicker. You get your files simply by listening <code>getSelectedFiles()</code> which returns an <code>ObservableList&lt;File&gt;</code> which is updated on user selection. In case of single selection mode, you can alternatively use <code>getSelectedFile()</code> which returns a <code>ReadOnlyObjectProperty&lt;File&gt;</code>.</p>
<p>The GWT implementation of <code>FilePicker.getView()</code> will show your node instead of the ugly default button - which is still present in the HTML page by the way to make things work, but hidden behind your beautiful JavaFX node with some CSS tricks.</p>
<p>For the <strong>drag &amp; drop</strong> support, your code will typically look like this:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// When the user drags files over that node,</span></span><br><span class="line"><span class="comment">// we tell the system we are accepting them</span></span><br><span class="line">myDragAndDropZoneNode.setOnDragOver(e -&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.getDragboard().hasContent(DataFormat.FILES)) &#123;</span><br><span class="line">        e.acceptTransferModes(TransferMode.COPY);</span><br><span class="line">        ... <span class="comment">// Good to do a visual change here</span></span><br><span class="line">        ... <span class="comment">// such as changing the border of the node</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// When the user finally drops the files on that node, we get them</span></span><br><span class="line">myDragAndDropZoneNode.setOnDragDropped(e -&gt; &#123;</span><br><span class="line">    <span class="type">Dragboard</span> <span class="variable">db</span> <span class="operator">=</span> e.getDragboard();</span><br><span class="line">    <span class="keyword">if</span> (db.hasContent(DataFormat.FILES)) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">platformFiles</span> <span class="operator">=</span> db.getContent(DataFormat.FILES);</span><br><span class="line">        List&lt;File&gt; fileList = File.createFileList(platformFiles);</span><br><span class="line">        ... <span class="comment">// Your logic to do what you need to do with these files </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Please note that the object returned by <code>db.getContent(DataFormat.FILES)</code> is a native list of the files from the underlying platform, so not usable as is in your code, but you can transform it into a cross-platform list of files by calling <code>File.createFileList()</code>.</p>
<p>Here is now what you can do with the WebFX File instances:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Getting the file name (doesn&#x27;t include the folder path)</span></span><br><span class="line"><span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getName();</span><br><span class="line"><span class="comment">// Getting the file length in bytes</span></span><br><span class="line"><span class="type">long</span> <span class="variable">fileLength</span> <span class="operator">=</span> file.length();</span><br><span class="line"><span class="comment">// Getting the last modified date &amp; time in Epoch milliseconds</span></span><br><span class="line"><span class="type">long</span> <span class="variable">fileLastModified</span> <span class="operator">=</span> file.lastModified();</span><br><span class="line"><span class="comment">// Getting the MIME type of the file</span></span><br><span class="line"><span class="type">String</span> <span class="variable">mimeType</span> <span class="operator">=</span> file.getMimeType();</span><br><span class="line"><span class="comment">// Getting an object URL to reference the contents of the file</span></span><br><span class="line"><span class="type">String</span> <span class="variable">objectURL</span> <span class="operator">=</span> file.getObjectURL();</span><br></pre></td></tr></table></figure>

<p>The GWT version of <code>File.getObjectURL()</code> calls the Web API <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/URL/createObjectURL">URL.createObjectURL()</a> which returns a sandboxed URL that can be used to <strong>open the file</strong> as follows (the same code also works of course on the Java&#x2F;JavaFX platform):</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*** IMAGE FILES (MIME type starting with &quot;image/&quot;) ***/</span></span><br><span class="line"><span class="type">ImageView</span> <span class="variable">imageView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageView</span>(file.getObjectURL());</span><br><span class="line"><span class="comment">// Alternatively using Image to control the background loading</span></span><br><span class="line"><span class="type">Image</span> <span class="variable">image</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Image</span>(file.getURLPath(), <span class="literal">true</span>); <span class="comment">// backgroundLoading</span></span><br><span class="line"><span class="type">ImageView</span> <span class="variable">imageView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageView</span>(image);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*** AUDIO &amp; VIDEOS (MIME type starting with &quot;audio/&quot; &amp; &quot;video/&quot;) ***/</span></span><br><span class="line"><span class="type">Media</span> <span class="variable">media</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Media</span>(file.getObjectURL());</span><br><span class="line"><span class="type">MediaPlayer</span> <span class="variable">mediaPlayer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>(media);</span><br><span class="line">mediaPlayer.play(); <span class="comment">// This will play only the sound</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*** TEXT FILES (MIME type starting with &quot;text/&quot;) ***/</span></span><br><span class="line"><span class="type">TextArea</span> <span class="variable">textArea</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TextArea</span>();</span><br><span class="line">FileReader.create()   <span class="comment">// FileReader is also part of the WebFX File API</span></span><br><span class="line">    .readAsText(file) <span class="comment">// Asynchronous call </span></span><br><span class="line">    .onSuccess(textArea::setText); <span class="comment">// Successful callback</span></span><br></pre></td></tr></table></figure>

<h1 id="What’s-next"><a href="#What’s-next" class="headerlink" title="What’s next?"></a>What’s next?</h1><p>We will soon provide the video support, so you can play your video files as follows:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Media</span> <span class="variable">media</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Media</span>(videoFile.getObjectURL());</span><br><span class="line"><span class="type">MediaPlayer</span> <span class="variable">mediaPlayer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaPlayer</span>(media);</span><br><span class="line"><span class="type">MediaView</span> <span class="variable">mediaView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MediaView</span>(mediaPlayer);</span><br><span class="line">myBorderPane.setCenter(mediaView);</span><br><span class="line">mediaPlayer.play();</span><br></pre></td></tr></table></figure>

<p>For your info, the Web File API we just investigated here is the standard API supported by all browsers. There is another one called the <a target="_blank" rel="noopener" href="https://web.dev/file-system-access/">File System Access API</a> which is experimental for now (only Chromium-based browsers support it), but much more extensive. It will allow for example to save files back to the local device.     </p>
<p>If you have any question or comment, you can use this GitHub discussion dedicated to this topic. In particular if you would like WebFX to support the experimental File System Access API, let us know, and we will investigate further.</p>
<p>Thank you for reading!</p>
</div></article></div></main><footer><div class="paginator"></div><div class="copyright"><p><a href="https://webfx.dev" target="_blank">WebFX</a> © 2021 - 2022</p></div></footer></div><!--script(async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous")--></body></html>